<!-- Do not edit below -->
<script type="application/json" id="tile-settings">
{
  "schema": "0.1.0",
  "settings": [
    {"name": "api", "type": "STRING", "label": "*API Key"},
    {"name": "lat", "label": "*Latitude", "type": "STRING"},
    {"type": "STRING", "label": "*Longitude", "name": "lon"},
    {"type": "BOOLEAN", "name": "unit", "label": "Display measures in Celsius"},
    {
      "name": "lang",
      "type": "STRING",
      "label": "Language (optional) - Default: en"
    },
    {
      "name": "textColor",
      "label": "Text Color (ex: White, #FF8C00, rgb(0,0,0))",
      "type": "STRING"
    }
  ],
  "name": "Weather Widget"
}
</script>
<script src="https://cdn.sharptools.io/js/custom-tiles.js"></script>
<script>
function showMsg(message,color){
	console.error(message);
	stio.showToast(message,color);
}

function poll(){
	var settings,unit,language,textColor
	stio.ready().then(function(data){
	settings = data && data.settings;
	if((settings.api == null || settings.api == "") && (settings.lat == null || settings.lat == "") && (settings.lon == null || settings.lon == "")){
	showMsg("To begin, edit the tile and enter the required (*) fields.","blue")
	}else{
	if(settings.api == null || settings.api == ""){
		showMsg("An API Key is required.","red");
	}
	if(settings.lat == null || settings.lat == ""){
		showMsg("The location Latitude is required.","red");
	}	
    if(settings.lon == null || settings.lon == ""){
		showMsg("The location Longitude is required.","red");
	}
	}
	if(settings.unit){
		unit = "metric"
	}else{
		unit = "imperial"
	}
	if(settings.lang == null || settings.lang == ""){
		language = "en"
	}else{
		language = settings.lang
	}
	if(settings.textColor == null || settings.textColor == ""){
		textColor = "#FFF"
	}else{
		textColor = settings.textColor
	}

var key      = settings.api,
	lat      = settings.lat,
	lon      = settings.lon,
	units    = unit,
    lang     = language,
	api_call = 'https://api.openweathermap.org/data/2.5/onecall?units=' + units + '&lat=' + lat + '&lon=' + lon + '&lang=' + lang + '&appid=' + key;

    fetch(api_call)  
	.then(function(resp){
		return resp.json()
	})
	.then(function(data){
      renderWeather(data,unit,textColor)
	})
	.catch(function() {
	});
    });
}

function renderWeather(d,unit,textColor){
    console.log(d);
  	console.log(textColor);	
  	const weatherColor = textColor
//Do not edit above -->
//******************************* -->
//Place custom content (JavaScript/HTML) below this line -->
//******************************* -->
//Begin JavaScript -->
	function getDay(day){
	var day
	switch(day){
		case 0:
		day = "SUN"
		break;
		case 1:
		day = "MON"
		break;
		case 2:
		day = "TUE"
		break;
		case 3:
		day = "WED"
		break;
		case 4:
		day = "THU"
		break;
		case 5:
		day = "FRI"
		break;
		case 6:
		day = "SAT"
		break;
	}
	return day
	}

	document.getElementById("container").style.color = weatherColor;
	document.getElementById('today').innerHTML = "TODAY"
  	document.getElementById('icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.current.weather[0].icon + "@2x.png>";
	document.getElementById('dh').innerHTML = "H:" + Math.round(d.daily[0].temp.max) + "&deg";
	document.getElementById('dl').innerHTML = "L:" + Math.round(d.daily[0].temp.min) + "&deg";
	document.getElementById('temp').innerHTML = Math.round(d.current.temp) + "&deg";
	document.getElementById('description').innerHTML = d.daily[0].weather[0].description.toUpperCase();
	document.getElementById('d1').innerHTML = getDay(new Date(d.daily[1].dt*1000).getDay());
	document.getElementById('d1icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.daily[1].weather[0].icon + ".png style='vertical-align:middle'>";
	document.getElementById('d1h').innerHTML = Math.round(d.daily[1].temp.max)+"&deg";
	document.getElementById('d1l').innerHTML = Math.round(d.daily[1].temp.min)+"&deg";
	document.getElementById('d2').innerHTML = getDay(new Date(d.daily[2].dt*1000).getDay());
	document.getElementById('d2icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.daily[2].weather[0].icon + ".png style='vertical-align:middle'>";
	document.getElementById('d2h').innerHTML = Math.round(d.daily[2].temp.max)+"&deg";
	document.getElementById('d2l').innerHTML = Math.round(d.daily[2].temp.min)+"&deg";
	document.getElementById('d3').innerHTML = getDay(new Date(d.daily[3].dt*1000).getDay());
	document.getElementById('d3icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.daily[3].weather[0].icon + ".png style='vertical-align:middle'>";
	document.getElementById('d3h').innerHTML = Math.round(d.daily[3].temp.max)+"&deg";
	document.getElementById('d3l').innerHTML = Math.round(d.daily[3].temp.min)+"&deg";
	document.getElementById('d4').innerHTML = getDay(new Date(d.daily[4].dt*1000).getDay());
	document.getElementById('d4icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.daily[4].weather[0].icon + ".png style='vertical-align:middle'>";
	document.getElementById('d4h').innerHTML = Math.round(d.daily[4].temp.max)+"&deg";
	document.getElementById('d4l').innerHTML = Math.round(d.daily[4].temp.min)+"&deg";
	document.getElementById('d5').innerHTML = getDay(new Date(d.daily[5].dt*1000).getDay());
	document.getElementById('d5icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.daily[5].weather[0].icon + ".png style='vertical-align:middle'>";
	document.getElementById('d5h').innerHTML = Math.round(d.daily[5].temp.max)+"&deg";
	document.getElementById('d5l').innerHTML = Math.round(d.daily[5].temp.min)+"&deg";
	document.getElementById('d6').innerHTML = getDay(new Date(d.daily[6].dt*1000).getDay());
	document.getElementById('d6icon').innerHTML = "<img src = https://openweathermap.org/img/wn/" + d.daily[6].weather[0].icon + ".png style='vertical-align:middle'>";
	document.getElementById('d6h').innerHTML = Math.round(d.daily[6].temp.max)+"&deg";
	document.getElementById('d6l').innerHTML = Math.round(d.daily[6].temp.min)+"&deg";

//End custom JavaScript -->
}//Do not delete this line
</script><!-- Do not delete this line -->
<!-- Place HTML below this line -->
<style>
	html {font-size:.85em}
<div id="container" style="width:100%;">
	<table style="width: 100%">
		<tbody><tr>
			<td style="width:50%;">
			<table style="width: 100%; text-align:center">
				<tbody><tr>
					<td id="today" style="padding-top:15px" colspan="2"></td>
				</tr>
					<tr>
					<td id="description" colspan="2"></td>
				</tr>
				<tr>
					<td id="dh"></td>
					<td id="dl"></td>
				</tr>
				<tr>
					<td colspan="2"><hr style="width:80%"></td>
				</tr>
				<tr>
					<td id="icon" colspan="2"></td>
				</tr>
				<tr>
					<td id="temp" style="font-size:5em" colspan="2"></td>
				</tr>
			</tbody></table>
			</td>
			<td style="width: 100%;">
			<table style="width: 100%;">
				<tbody><tr>
					<td id="d1"></td>
					<td id="d1icon"></td>
					<td id="d1h"></td>
					<td id="d1l"></td>
				</tr>
				<tr>
					<td id="d2"></td>
					<td id="d2icon"></td>
					<td id="d2h"></td>
					<td id="d2l"></td>
				</tr>
				<tr>
					<td id="d3"></td>
					<td id="d3icon"></td>
					<td id="d3h"></td>
					<td id="d3l"></td>
				</tr>
				<tr>
					<td id="d4"></td>
					<td id="d4icon"></td>
					<td id="d4h"></td>
					<td id="d4l"></td>
				</tr>
				<tr>
					<td id="d5"></td>
					<td id="d5icon"></td>
					<td id="d5h"></td>
					<td id="d5l"></td>
				</tr>
				<tr>
					<td id="d6"></td>
					<td id="d6icon"></td>
					<td id="d6h"></td>
					<td id="d6l"></td>
				</tr>
			</tbody></table>
			</td>
		</tr>
	</tbody></table>
</div>
<!--******************************* -->
<!--End custom content -->
<!--******************************* -->
<!-- Do not edit below -->
<script>
window.onload = function(){
	poll();
}
setInterval(poll, 900000);
</script>
